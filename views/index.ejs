<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
  />
  <link rel="stylesheet" href="/css/style.css" />
  <title>Yt2mp3</title>
</head>
<body>
  <div class="top-container">
    <!-- Google Sign-In Button -->
    <div id="g_id_onload"
        data-client_id="YOUR_GOOGLE_CLIENT_ID"
        data-context="signin"
        data-ux_mode="popup"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
        data-type="standard"
        data-shape="rectangular"
        data-theme="filled_blue"
        data-text="signin_with"
        data-size="large"
        data-logo_alignment="left">
    </div>

    <!-- Converter Form -->
    <form action="/convert-mp3" method="POST" id="form">
      <h1>Yt2mp3</h1>
      <h4>Enter the video ID</h4>
      <div>
        <input type="text" name="videoID" placeholder="Video ID" />
        <button id="convert-btn">Convert</button>
      </div>
    </form>
  </div>

  <div class="bottom-container">
    <% if (typeof success !== "undefined" && success) { %>
      <div class="success">
        <p><%= song_title %></p>
        <a href="<%= song_link %>">
          <button id="download-btn">DOWNLOAD</button>
        </a>
      </div>
    <% } else if (typeof success !== "undefined" && !success) { %>
      <div class="errors">
        <p><%= message %></p>
      </div>
    <% } %>
  </div>

  <!-- Google Sign-In script -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    function handleCredentialResponse(response) {
      fetch('/verify-google-token', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ credential: response.credential })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert(`Welcome ${data.name}`);
        } else {
          alert("Authentication failed.");
        }
      })
      .catch(err => {
        console.error("Error verifying token:", err);
      });
    }
  </script>
</body>
</html>
